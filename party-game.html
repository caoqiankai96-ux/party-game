<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤´é¡¶çŒœè¯ - èšä¼šæ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.8s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        // æ¸¸æˆé…ç½® - ä¼˜åŒ–è·¨è®¾å¤‡åŒæ­¥é€»è¾‘
        const STORAGE_KEY = 'party_game_rooms';
        const ROOM_EXPIRE_TIME = 3600000; // æˆ¿é—´è¿‡æœŸæ—¶é—´ï¼š1å°æ—¶
        const SYNC_INTERVAL = 1000; // åŒæ­¥é—´éš”ï¼š1ç§’ï¼ˆç¼©çŸ­åˆ·æ–°é¢‘ç‡ï¼‰
        
        // è¯è¯­åº“
        const wordPool = [
            'å¤§è±¡', 'é’¢ç´', 'ç«ç®­', 'å†°æ·‡æ·‹', 'è¶…äºº', 'ç†ŠçŒ«', 'æ±‰å ¡', 'é—ªç”µ',
            'å½©è™¹', 'æé¾™', 'èœ˜è››ä¾ ', 'è¥¿ç“œ', 'ç«è½¦', 'ä¼é¹…', 'ç”µå‰ä»–', 'ç‹¬è§’å…½',
            'å¯¿å¸', 'çƒ­æ°”çƒ', 'æµ·è±š', 'é­”æ–¹', 'æ£’æ£’ç³–', 'é™è½ä¼', 'ç« é±¼', 'ç«å±±',
            'æ»‘æ¿', 'é•¿é¢ˆé¹¿', 'æ‘©æ‰˜è½¦', 'ç”œç”œåœˆ', 'ç›´å‡æœº', 'è€ƒæ‹‰', 'æŠ«è¨', 'å¸†èˆ¹'
        ];

        // çœŸå¿ƒè¯å¤§å†’é™©åº“
        const truthOrDarePool = {
            truth: [
                'è¯´å‡ºä½ æœ€å°´å°¬çš„ä¸€æ¬¡ç»å†',
                'åˆ†äº«ä½ æš—æ‹è¿‡çš„äººçš„åå­—',
                'è¯´å‡ºä½ åšè¿‡æœ€åæ‚”çš„äº‹',
                'é€éœ²ä½ æœ€ä¸æƒ³è®©åˆ«äººçŸ¥é“çš„ç§˜å¯†',
                'è¯´å‡ºä½ æ‰‹æœºé‡Œæœ€åä¸€å¼ è‡ªæ‹',
                'åˆ†äº«ä½ æœ€å®³æ€•çš„ä¸œè¥¿',
                'è¯´å‡ºä½ æ’’è¿‡æœ€å¤§çš„è°',
                'é€éœ²ä½ æœ€æƒ³æ”¹å˜è‡ªå·±çš„ä¸€ç‚¹'
            ],
            dare: [
                'æ¨¡ä»¿ä¸€ä¸ªåŠ¨ç‰©å«å£°æŒç»­10ç§’',
                'è·³ä¸€æ®µå°´å°¬çš„èˆè¹ˆ',
                'ç”¨ä¸€ç§æç¬‘çš„å£éŸ³è¯´è¯ç›´åˆ°ä¸‹ä¸€è½®',
                'åš20ä¸ªä¿¯å§æ’‘',
                'ç»™é€šè®¯å½•é‡Œçš„ç¬¬5ä¸ªäººå‘ä¸€æ¡"æˆ‘çˆ±ä½ "',
                'è®©å…¶ä»–äººåœ¨ä½ è„¸ä¸Šç”»ä¸€ä¸ªå›¾æ¡ˆ',
                'é—­çœ¼è½¬åœˆ10åœˆç„¶åèµ°ç›´çº¿',
                'åƒä¸€å‹ºè°ƒæ–™(è¾£æ¤’ç²‰/èŠ¥æœ«/é†‹ç­‰)'
            ]
        };

        // å­˜å‚¨ç®¡ç† - ä¼˜åŒ–è·¨è®¾å¤‡/è·¨æ ‡ç­¾é¡µåŒæ­¥
        class Storage {
            static getRooms() {
                try {
                    const data = localStorage.getItem(STORAGE_KEY);
                    const rooms = data ? JSON.parse(data) : {};
                    // æ¸…ç†è¿‡æœŸæˆ¿é—´
                    this.cleanExpiredRooms(rooms);
                    return rooms;
                } catch (e) {
                    console.error('è¯»å–æˆ¿é—´å¤±è´¥:', e);
                    return {};
                }
            }

            static saveRooms(rooms) {
                try {
                    // æ¸…ç†è¿‡æœŸæˆ¿é—´åå†ä¿å­˜
                    this.cleanExpiredRooms(rooms);
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(rooms));
                    // è§¦å‘å­˜å‚¨äº‹ä»¶ï¼Œè®©å…¶ä»–æ ‡ç­¾é¡µåŒæ­¥
                    window.dispatchEvent(new StorageEvent('storage', {
                        key: STORAGE_KEY,
                        newValue: JSON.stringify(rooms)
                    }));
                } catch (e) {
                    console.error('ä¿å­˜æˆ¿é—´å¤±è´¥:', e);
                }
            }

            static getRoom(code) {
                if (!code) return null;
                // å¼ºåˆ¶ç»Ÿä¸€æˆ¿é—´å·ä¸ºå¤§å†™ï¼Œé¿å…å¤§å°å†™ä¸ä¸€è‡´
                const normalizedCode = code.trim().toUpperCase();
                const rooms = this.getRooms();
                return rooms[normalizedCode] || null;
            }

            static setRoom(code, data) {
                if (!code || !data) return;
                const normalizedCode = code.trim().toUpperCase();
                const rooms = this.getRooms();
                // è¡¥å……æˆ¿é—´æ›´æ–°æ—¶é—´ï¼Œç”¨äºè¿‡æœŸåˆ¤æ–­
                data.updatedAt = Date.now();
                rooms[normalizedCode] = data;
                this.saveRooms(rooms);
            }

            static deleteRoom(code) {
                const normalizedCode = code.trim().toUpperCase();
                const rooms = this.getRooms();
                delete rooms[normalizedCode];
                this.saveRooms(rooms);
            }

            // æ¸…ç†è¿‡æœŸæˆ¿é—´
            static cleanExpiredRooms(rooms) {
                const now = Date.now();
                for (const code in rooms) {
                    const room = rooms[code];
                    const roomTime = room.updatedAt || room.createdAt || 0;
                    if (now - roomTime > ROOM_EXPIRE_TIME) {
                        delete rooms[code];
                    }
                }
            }

            // è·¨è®¾å¤‡åŒæ­¥è¾…åŠ©ï¼šå¹¿æ’­æˆ¿é—´æ›´æ–°ï¼ˆä»…åŒæµè§ˆå™¨æ ‡ç­¾é¡µç”Ÿæ•ˆï¼‰
            static broadcastRoomUpdate() {
                window.dispatchEvent(new CustomEvent('roomUpdated'));
            }
        }

        // æ¸¸æˆçŠ¶æ€ç®¡ç† - ä¿®å¤åŠ å…¥æˆ¿é—´æ ¸å¿ƒé—®é¢˜
        class GameState {
            constructor() {
                this.screen = 'home';
                this.roomCode = '';
                this.playerName = '';
                this.playerCount = 4;
                this.gameData = null;
                this.currentPlayerId = null;
                this.guessInput = '';
                this.truthOrDareData = null;
                this.showHelp = false;
                this.copied = false;
                
                // ç›‘å¬å­˜å‚¨å˜åŒ–ï¼ˆè·¨æ ‡ç­¾é¡µï¼‰
                window.addEventListener('storage', (e) => {
                    if (e.key === STORAGE_KEY && this.roomCode) {
                        this.loadRoom();
                    }
                });

                // ç›‘å¬è‡ªå®šä¹‰æˆ¿é—´æ›´æ–°äº‹ä»¶ï¼ˆåŒæµè§ˆå™¨ï¼‰
                window.addEventListener('roomUpdated', () => {
                    if (this.roomCode) {
                        this.loadRoom();
                    }
                });

                // ç¼©çŸ­åŒæ­¥é—´éš”ï¼Œæå‡å®æ—¶æ€§
                setInterval(() => {
                    if (this.roomCode && this.screen !== 'home') {
                        this.loadRoom();
                    }
                }, SYNC_INTERVAL);

                // åˆå§‹åŒ–æ—¶åŠ è½½æˆ¿é—´ï¼ˆå¦‚æœæœ‰ç¼“å­˜çš„roomCodeï¼‰
                this.initRoomFromCache();
            }

            // ä»ç¼“å­˜æ¢å¤æˆ¿é—´ï¼ˆæ¯”å¦‚åˆ·æ–°é¡µé¢åï¼‰
            initRoomFromCache() {
                const cachedRoomCode = localStorage.getItem('party_game_current_room');
                const cachedPlayerId = localStorage.getItem('party_game_player_id');
                if (cachedRoomCode && cachedPlayerId) {
                    this.roomCode = cachedRoomCode;
                    this.currentPlayerId = cachedPlayerId;
                    this.loadRoom();
                }
            }

            // ä¼˜åŒ–æˆ¿é—´åŠ è½½é€»è¾‘
            loadRoom() {
                const room = Storage.getRoom(this.roomCode);
                if (room) {
                    this.gameData = room;
                    // ä¿å­˜å½“å‰æˆ¿é—´å’Œç©å®¶IDåˆ°ç¼“å­˜
                    localStorage.setItem('party_game_current_room', this.roomCode);
                    localStorage.setItem('party_game_player_id', this.currentPlayerId);
                    if (room.started && this.screen === 'lobby') {
                        this.screen = 'playing';
                    }
                    this.render();
                } else {
                    // æˆ¿é—´ä¸å­˜åœ¨æ—¶æ¸…ç©ºç¼“å­˜
                    localStorage.removeItem('party_game_current_room');
                    localStorage.removeItem('party_game_player_id');
                    if (this.screen !== 'home') {
                        alert('æˆ¿é—´å·²è¿‡æœŸæˆ–ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°åˆ›å»º/åŠ å…¥');
                        this.screen = 'home';
                        this.render();
                    }
                }
            }

            // ä¼˜åŒ–åˆ›å»ºæˆ¿é—´é€»è¾‘
            createRoom() {
                if (!this.playerName.trim()) {
                    alert('è¯·è¾“å…¥ä½ çš„åå­—');
                    return;
                }

                // ç”Ÿæˆæ›´ç¨³å®šçš„6ä½å¤§å†™æˆ¿é—´å·
                const code = Math.random().toString(36).substring(2, 8).toUpperCase();
                const playerId = Math.random().toString(36).substring(2, 15);
                
                const words = [...wordPool].sort(() => Math.random() - 0.5).slice(0, this.playerCount);
                
                const game = {
                    roomCode: code,
                    maxPlayers: this.playerCount,
                    players: [{
                        id: playerId,
                        name: this.playerName,
                        word: words[0],
                        guessed: false,
                        order: 0
                    }],
                    words: words,
                    started: false,
                    currentTurn: 0,
                    winner: null,
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                };

                // ä¿å­˜æˆ¿é—´
                Storage.setRoom(code, game);
                // å¹¿æ’­æ›´æ–°
                Storage.broadcastRoomUpdate();
                
                this.roomCode = code;
                this.currentPlayerId = playerId;
                this.gameData = game;
                this.screen = 'lobby';
                this.render();
            }

            // ä¿®å¤åŠ å…¥æˆ¿é—´æ ¸å¿ƒé€»è¾‘
            joinRoom() {
                if (!this.playerName.trim()) {
                    alert('è¯·è¾“å…¥ä½ çš„åå­—');
                    return;
                }
                if (!this.roomCode.trim()) {
                    alert('è¯·è¾“å…¥æˆ¿é—´å·');
                    return;
                }

                // ç»Ÿä¸€æˆ¿é—´å·æ ¼å¼
                const normalizedCode = this.roomCode.trim().toUpperCase();
                const game = Storage.getRoom(normalizedCode);
                
                if (!game) {
                    alert('æˆ¿é—´ä¸å­˜åœ¨ï¼è¯·æ£€æŸ¥æˆ¿é—´å·æ˜¯å¦æ­£ç¡®ï¼Œæˆ–æˆ¿é—´å·²è¿‡æœŸ');
                    return;
                }

                if (game.players.length >= game.maxPlayers) {
                    alert(`æˆ¿é—´å·²æ»¡ï¼ˆæœ€å¤š${game.maxPlayers}äººï¼‰`);
                    return;
                }

                if (game.started) {
                    alert('æ¸¸æˆå·²å¼€å§‹ï¼Œæ— æ³•åŠ å…¥');
                    return;
                }

                // æ£€æŸ¥æ˜¯å¦å·²åŠ å…¥è¯¥æˆ¿é—´
                const isAlreadyJoined = game.players.some(p => 
                    p.name === this.playerName.trim()
                );
                if (isAlreadyJoined) {
                    alert('è¯¥åå­—å·²åŠ å…¥æˆ¿é—´ï¼Œè¯·æ›´æ¢åå­—');
                    return;
                }

                const playerId = Math.random().toString(36).substring(2, 15);
                const newPlayer = {
                    id: playerId,
                    name: this.playerName.trim(),
                    word: game.words[game.players.length],
                    guessed: false,
                    order: game.players.length
                };

                game.players.push(newPlayer);
                game.updatedAt = Date.now(); // æ›´æ–°æˆ¿é—´æ—¶é—´
                Storage.setRoom(normalizedCode, game);
                Storage.broadcastRoomUpdate(); // å¹¿æ’­æ›´æ–°

                this.currentPlayerId = playerId;
                this.gameData = game;
                this.screen = 'lobby';
                this.render();
            }

            startGame() {
                if (!this.gameData) return;
                if (this.gameData.players.length < 2) {
                    alert('è‡³å°‘éœ€è¦2åç©å®¶æ‰èƒ½å¼€å§‹');
                    return;
                }

                this.gameData.started = true;
                this.gameData.updatedAt = Date.now();
                Storage.setRoom(this.roomCode, this.gameData);
                Storage.broadcastRoomUpdate();
                this.screen = 'playing';
                this.render();
            }

            makeGuess() {
                if (!this.guessInput.trim()) {
                    alert('è¯·è¾“å…¥ä½ çš„çŒœæµ‹');
                    return;
                }
                if (!this.gameData) return;

                const currentPlayer = this.gameData.players.find(p => p.id === this.currentPlayerId);
                if (!currentPlayer) return;
                
                if (this.guessInput.trim() === currentPlayer.word) {
                    const playerIndex = this.gameData.players.findIndex(p => p.id === this.currentPlayerId);
                    this.gameData.players[playerIndex].guessed = true;
                    this.gameData.winner = currentPlayer.name;
                    this.gameData.updatedAt = Date.now();
                    
                    Storage.setRoom(this.roomCode, this.gameData);
                    Storage.broadcastRoomUpdate();
                    this.guessInput = '';
                    this.render();
                } else {
                    alert('çŒœé”™äº†ï¼ç»§ç»­åŠ æ²¹ï¼');
                    this.guessInput = '';
                    this.render();
                }
            }

            triggerTruthOrDare() {
                if (!this.gameData) return;
                const randomPlayer = this.gameData.players[Math.floor(Math.random() * this.gameData.players.length)];
                const type = Math.random() > 0.5 ? 'truth' : 'dare';
                const challenge = truthOrDarePool[type][Math.floor(Math.random() * truthOrDarePool[type].length)];
                
                this.truthOrDareData = {
                    player: randomPlayer.name,
                    type: type,
                    challenge: challenge
                };
                this.screen = 'truthOrDare';
                this.render();
            }

            copyRoomCode() {
                if (!this.roomCode) return;
                navigator.clipboard.writeText(this.roomCode)
                    .then(() => {
                        this.copied = true;
                        this.render();
                        setTimeout(() => {
                            this.copied = false;
                            this.render();
                        }, 2000);
                    })
                    .catch(() => {
                        // é™çº§æ–¹æ¡ˆï¼šæ‰‹åŠ¨é€‰ä¸­æˆ¿é—´å·
                        const tempInput = document.createElement('input');
                        tempInput.value = this.roomCode;
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempInput);
                        this.copied = true;
                        this.render();
                        setTimeout(() => {
                            this.copied = false;
                            this.render();
                        }, 2000);
                    });
            }

            render() {
                const app = document.getElementById('app');
                app.innerHTML = this.getHTML();
                this.attachEvents();
            }

            attachEvents() {
                // ä¸»é¡µäº‹ä»¶
                const createBtn = document.getElementById('createBtn');
                const joinBtn = document.getElementById('joinBtn');
                const helpBtn = document.getElementById('helpBtn');
                
                if (createBtn) createBtn.onclick = () => { this.screen = 'create'; this.render(); };
                if (joinBtn) joinBtn.onclick = () => { this.screen = 'join'; this.render(); };
                if (helpBtn) helpBtn.onclick = () => { this.showHelp = true; this.render(); };

                // å¸®åŠ©å¼¹çª—
                const closeHelpBtn = document.getElementById('closeHelpBtn');
                const helpOverlay = document.getElementById('helpOverlay');
                if (closeHelpBtn) closeHelpBtn.onclick = () => { this.showHelp = false; this.render(); };
                if (helpOverlay) helpOverlay.onclick = () => { this.showHelp = false; this.render(); };

                // è¿”å›æŒ‰é’®
                const backBtn = document.getElementById('backBtn');
                if (backBtn) backBtn.onclick = () => { 
                    // è¿”å›ä¸»é¡µæ—¶æ¸…ç©ºç¼“å­˜
                    localStorage.removeItem('party_game_current_room');
                    localStorage.removeItem('party_game_player_id');
                    this.screen = 'home'; 
                    this.render(); 
                };

                // åˆ›å»ºæˆ¿é—´
                const playerNameInput = document.getElementById('playerNameInput');
                const playerCountSelect = document.getElementById('playerCountSelect');
                const createRoomBtn = document.getElementById('createRoomBtn');
                
                if (playerNameInput) {
                    playerNameInput.value = this.playerName;
                    playerNameInput.oninput = (e) => { this.playerName = e.target.value; };
                }
                if (playerCountSelect) {
                    playerCountSelect.value = this.playerCount;
                    playerCountSelect.onchange = (e) => { this.playerCount = Number(e.target.value); };
                }
                if (createRoomBtn) createRoomBtn.onclick = () => this.createRoom();

                // åŠ å…¥æˆ¿é—´ - å®æ—¶ç»Ÿä¸€æˆ¿é—´å·ä¸ºå¤§å†™
                const roomCodeInput = document.getElementById('roomCodeInput');
                const joinRoomBtn = document.getElementById('joinRoomBtn');
                
                if (roomCodeInput) {
                    roomCodeInput.value = this.roomCode;
                    roomCodeInput.oninput = (e) => { 
                        // è¾“å…¥æ—¶è‡ªåŠ¨è½¬ä¸ºå¤§å†™ï¼Œé¿å…ç”¨æˆ·è¾“å…¥å°å†™
                        this.roomCode = e.target.value.toUpperCase(); 
                        e.target.value = this.roomCode;
                    };
                }
                if (joinRoomBtn) joinRoomBtn.onclick = () => this.joinRoom();

                // å¤åˆ¶æˆ¿é—´å·
                const copyBtn = document.getElementById('copyBtn');
                if (copyBtn) copyBtn.onclick = () => this.copyRoomCode();

                // å¼€å§‹æ¸¸æˆ
                const startGameBtn = document.getElementById('startGameBtn');
                if (startGameBtn) startGameBtn.onclick = () => this.startGame();

                // çŒœè¯
                const guessInput = document.getElementById('guessInput');
                const guessBtn = document.getElementById('guessBtn');
                
                if (guessInput) {
                    guessInput.value = this.guessInput;
                    guessInput.oninput = (e) => { this.guessInput = e.target.value; };
                    guessInput.onkeypress = (e) => { if (e.key === 'Enter') this.makeGuess(); };
                }
                if (guessBtn) guessBtn.onclick = () => this.makeGuess();

                // çœŸå¿ƒè¯å¤§å†’é™©
                const truthOrDareBtn = document.getElementById('truthOrDareBtn');
                const continuePlaying = document.getElementById('continuePlaying');
                const returnHome = document.getElementById('returnHome');
                
                if (truthOrDareBtn) truthOrDareBtn.onclick = () => this.triggerTruthOrDare();
                if (continuePlaying) continuePlaying.onclick = () => { this.screen = 'playing'; this.render(); };
                if (returnHome) returnHome.onclick = () => {
                    // è¿”å›ä¸»é¡µæ—¶æ¸…ç©ºç¼“å­˜
                    localStorage.removeItem('party_game_current_room');
                    localStorage.removeItem('party_game_player_id');
                    this.screen = 'home';
                    this.gameData = null;
                    this.roomCode = '';
                    this.playerName = '';
                    this.currentPlayerId = null;
                    this.render();
                };
            }

            getHTML() {
                if (this.screen === 'home') return this.getHomeHTML();
                if (this.screen === 'create') return this.getCreateHTML();
                if (this.screen === 'join') return this.getJoinHTML();
                if (this.screen === 'lobby') return this.getLobbyHTML();
                if (this.screen === 'playing') return this.getPlayingHTML();
                if (this.screen === 'truthOrDare') return this.getTruthOrDareHTML();
            }

            getHomeHTML() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center p-4">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.1),transparent_50%)] opacity-30"></div>
                        
                        ${this.showHelp ? this.getHelpModalHTML() : ''}
                        
                        <div class="relative max-w-lg w-full">
                            <div class="text-center mb-12 animate-fadeIn">
                                <div class="inline-block mb-6">
                                    <svg class="w-20 h-20 text-yellow-300 animate-pulse mx-auto" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                    </svg>
                                </div>
                                <h1 class="text-6xl font-black text-white mb-4 tracking-tight" style="font-family: Impact, sans-serif; text-shadow: 4px 4px 0px rgba(0,0,0,0.3);">
                                    å¤´é¡¶çŒœè¯
                                </h1>
                                <p class="text-xl text-pink-100 font-medium">èšä¼šå¿…å¤‡ï¼Œæ¬¢ä¹æ»¡æ»¡</p>
                            </div>

                            <div class="bg-yellow-400/20 border-2 border-yellow-400/50 rounded-2xl p-4 mb-6 backdrop-blur">
                                <button id="helpBtn" class="w-full flex items-center justify-between text-yellow-100 hover:text-white transition">
                                    <span class="flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                                        </svg>
                                        <span class="font-bold">å’Œæœ‹å‹ä¸€èµ·ç©ï¼Ÿç‚¹è¿™é‡ŒæŸ¥çœ‹æ•™ç¨‹</span>
                                    </span>
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <button id="createBtn" class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 py-6 rounded-2xl font-bold text-2xl shadow-2xl transform transition hover:scale-105 active:scale-95 flex items-center justify-center gap-3 border-4 border-yellow-200" style="font-family: Arial Black, sans-serif">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                    </svg>
                                    åˆ›å»ºæ¸¸æˆ
                                </button>

                                <button id="joinBtn" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-6 rounded-2xl font-bold text-2xl shadow-2xl transform transition hover:scale-105 active:scale-95 flex items-center justify-center gap-3 border-4 border-pink-300" style="font-family: Arial Black, sans-serif">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                    åŠ å…¥æˆ¿é—´
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            getCreateHTML() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center p-4">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.1),transparent_50%)] opacity-30"></div>
                        <div class="relative max-w-md w-full">
                            <button id="backBtn" class="absolute top-0 left-0 text-white hover:text-yellow-300 transition mb-6">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
                                </svg>
                            </button>
                            
                            <div class="text-center mb-8 animate-fadeIn">
                                <h2 class="text-4xl font-black text-white mb-2" style="font-family: Impact, sans-serif; text-shadow: 3px 3px 0px rgba(0,0,0,0.3);">
                                    åˆ›å»ºæ¸¸æˆæˆ¿é—´
                                </h2>
                                <p class="text-pink-100">è®¾ç½®ä½ çš„æ¸¸æˆä¿¡æ¯</p>
                            </div>

                            <div class="bg-white/10 backdrop-blur rounded-2xl p-6 border-2 border-white/20">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-yellow-300 font-bold mb-2">ä½ çš„åå­—</label>
                                        <input 
                                            id="playerNameInput" 
                                            type="text" 
                                            placeholder="è¾“å…¥ä½ çš„æ˜µç§°" 
                                            class="w-full bg-white/20 border-2 border-yellow-400/50 rounded-xl py-4 px-4 text-white placeholder-white/60 focus:outline-none focus:border-yellow-300 transition"
                                            maxlength="10"
                                        >
                                    </div>
                                    
                                    <div>
                                        <label class="block text-yellow-300 font-bold mb-2">æ¸¸æˆäººæ•°</label>
                                        <select 
                                            id="playerCountSelect" 
                                            class="w-full bg-white/20 border-2 border-yellow-400/50 rounded-xl py-4 px-4 text-white focus:outline-none focus:border-yellow-300 transition appearance-none bg-no-repeat bg-right pr-8"
                                            style="background-image: url('data:image/svg+xml;charset=US-ASCII,<svg width=\"20\" height=\"20\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M5 7l5 5 5-5z\" fill=\"%23ffffff\"/></svg>');"
                                        >
                                            <option value="2" class="bg-purple-900">2 äºº</option>
                                            <option value="3" class="bg-purple-900">3 äºº</option>
                                            <option value="4" class="bg-purple-900">4 äºº</option>
                                            <option value="5" class="bg-purple-900">5 äºº</option>
                                            <option value="6" class="bg-purple-900">6 äºº</option>
                                            <option value="7" class="bg-purple-900">7 äºº</option>
                                            <option value="8" class="bg-purple-900">8 äºº</option>
                                        </select>
                                    </div>
                                    
                                    <button 
                                        id="createRoomBtn" 
                                        class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95 mt-6"
                                    >
                                        åˆ›å»ºæˆ¿é—´
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getJoinHTML() {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex items-center justify-center p-4">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.1),transparent_50%)] opacity-30"></div>
                        <div class="relative max-w-md w-full">
                            <button id="backBtn" class="absolute top-0 left-0 text-white hover:text-yellow-300 transition mb-6">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
                                </svg>
                            </button>
                            
                            <div class="text-center mb-8 animate-fadeIn">
                                <h2 class="text-4xl font-black text-white mb-2" style="font-family: Impact, sans-serif; text-shadow: 3px 3px 0px rgba(0,0,0,0.3);">
                                    åŠ å…¥æ¸¸æˆæˆ¿é—´
                                </h2>
                                <p class="text-pink-100">è¾“å…¥æˆ¿é—´å·å’Œä½ çš„åå­—</p>
                            </div>

                            <div class="bg-white/10 backdrop-blur rounded-2xl p-6 border-2 border-white/20">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-yellow-300 font-bold mb-2">ä½ çš„åå­—</label>
                                        <input 
                                            id="playerNameInput" 
                                            type="text" 
                                            placeholder="è¾“å…¥ä½ çš„æ˜µç§°" 
                                            class="w-full bg-white/20 border-2 border-pink-400/50 rounded-xl py-4 px-4 text-white placeholder-white/60 focus:outline-none focus:border-pink-300 transition"
                                            maxlength="10"
                                        >
                                    </div>
                                    
                                    <div>
                                        <label class="block text-yellow-300 font-bold mb-2">æˆ¿é—´å·</label>
                                        <input 
                                            id="roomCodeInput" 
                                            type="text" 
                                            placeholder="è¾“å…¥6ä½æˆ¿é—´å·" 
                                            class="w-full bg-white/20 border-2 border-pink-400/50 rounded-xl py-4 px-4 text-white placeholder-white/60 focus:outline-none focus:border-pink-300 transition"
                                            maxlength="6"
                                        >
                                    </div>
                                    
                                    <button 
                                        id="joinRoomBtn" 
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95 mt-6"
                                    >
                                        åŠ å…¥æˆ¿é—´
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getLobbyHTML() {
                if (!this.gameData) return this.getHomeHTML();
                
                const playersList = this.gameData.players.map((player, index) => `
                    <div class="flex items-center gap-3 p-3 bg-white/10 rounded-xl border border-white/20 animate-slideIn" style="animation-delay: ${index * 0.1}s">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center font-bold text-gray-900">
                            ${index + 1}
                        </div>
                        <span class="text-white font-bold text-lg">${player.name}</span>
                    </div>
                `).join('');

                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex flex-col items-center justify-start p-4 pt-8">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.1),transparent_50%)] opacity-30"></div>
                        <div class="relative max-w-md w-full">
                            <button id="backBtn" class="absolute top-0 left-0 text-white hover:text-yellow-300 transition mb-6">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"/>
                                </svg>
                            </button>
                            
                            <div class="text-center mb-6 animate-fadeIn">
                                <h2 class="text-4xl font-black text-white mb-2" style="font-family: Impact, sans-serif; text-shadow: 3px 3px 0px rgba(0,0,0,0.3);">
                                    æˆ¿é—´ ${this.gameData.roomCode}
                                </h2>
                                <p class="text-pink-100">ç­‰å¾…ç©å®¶åŠ å…¥ (${this.gameData.players.length}/${this.gameData.maxPlayers})</p>
                            </div>

                            <!-- å¤åˆ¶æˆ¿é—´å·æŒ‰é’® -->
                            <div class="flex items-center justify-center mb-6">
                                <button 
                                    id="copyBtn" 
                                    class="flex items-center gap-2 bg-white/10 backdrop-blur rounded-xl py-2 px-6 border border-white/20 text-white hover:bg-white/20 transition"
                                >
                                    <svg class="w-5 h-5 ${this.copied ? 'text-green-400' : 'text-yellow-300'}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        ${this.copied ? 
                                            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>' : 
                                            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-1M8 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M8 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2"/>'
                                        }
                                    </svg>
                                    <span>${this.copied ? 'å·²å¤åˆ¶ï¼' : 'å¤åˆ¶æˆ¿é—´å·'}</span>
                                </button>
                            </div>

                            <!-- ç©å®¶åˆ—è¡¨ -->
                            <div class="bg-white/5 backdrop-blur rounded-2xl p-4 border-2 border-white/20 mb-6">
                                <h3 class="text-yellow-300 font-bold mb-4">å½“å‰ç©å®¶</h3>
                                <div class="space-y-2">
                                    ${playersList || '<p class="text-white text-center">æš‚æ— ç©å®¶</p>'}
                                </div>
                            </div>

                            <!-- å¼€å§‹æ¸¸æˆæŒ‰é’®ï¼ˆä»…æˆ¿ä¸»æ˜¾ç¤ºï¼‰ -->
                            ${this.gameData.players[0]?.id === this.currentPlayerId ? `
                                <button 
                                    id="startGameBtn" 
                                    class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95"
                                    ${this.gameData.players.length < 2 ? 'disabled' : ''}
                                    style="${this.gameData.players.length < 2 ? 'opacity: 0.5; cursor: not-allowed;' : ''}"
                                >
                                    å¼€å§‹æ¸¸æˆ
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            getPlayingHTML() {
                if (!this.gameData) return this.getHomeHTML();
                
                const currentPlayer = this.gameData.players.find(p => p.id === this.currentPlayerId);
                const isWinner = this.gameData.winner === currentPlayer?.name;

                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex flex-col items-center justify-center p-4">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.1),transparent_50%)] opacity-30"></div>
                        <div class="relative max-w-md w-full text-center">
                            ${isWinner ? `
                                <div class="animate-fadeIn">
                                    <h2 class="text-5xl font-black text-yellow-300 mb-4" style="font-family: Impact, sans-serif; text-shadow: 4px 4px 0px rgba(0,0,0,0.3);">
                                        æ­å–œä½ èµ¢äº†ï¼ğŸ‰
                                    </h2>
                                    <p class="text-white text-xl mb-8">ä½ çŒœå¯¹äº†ï¼š<span class="font-bold text-yellow-200">${currentPlayer.word}</span></p>
                                    
                                    <button 
                                        id="truthOrDareBtn" 
                                        class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95 mb-4"
                                    >
                                        çœŸå¿ƒè¯å¤§å†’é™©
                                    </button>
                                    
                                    <button 
                                        id="returnHome" 
                                        class="w-full bg-white/20 text-white py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95"
                                    >
                                        è¿”å›ä¸»é¡µ
                                    </button>
                                </div>
                            ` : `
                                <div class="animate-fadeIn">
                                    <h2 class="text-4xl font-black text-white mb-6" style="font-family: Impact, sans-serif; text-shadow: 3px 3px 0px rgba(0,0,0,0.3);">
                                        çŒœçŒœä½ çš„è¯æ˜¯ä»€ä¹ˆï¼Ÿ
                                    </h2>
                                    
                                    <div class="bg-white/10 backdrop-blur rounded-2xl p-6 border-2 border-white/20 mb-8">
                                        <p class="text-white text-lg mb-4">å…¶ä»–äººæ­£åœ¨æè¿°è¿™ä¸ªè¯ï¼Œä½ æ¥çŒœï¼</p>
                                        <div class="flex items-center justify-center gap-3 mb-6">
                                            <input 
                                                id="guessInput" 
                                                type="text" 
                                                placeholder="è¾“å…¥ä½ çš„çŒœæµ‹" 
                                                class="w-full bg-white/20 border-2 border-yellow-400/50 rounded-xl py-4 px-4 text-white placeholder-white/60 focus:outline-none focus:border-yellow-300 transition text-center text-xl"
                                            >
                                        </div>
                                        <button 
                                            id="guessBtn" 
                                            class="w-full bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 py-3 rounded-xl font-bold text-lg shadow-lg transform transition hover:scale-105 active:scale-95"
                                        >
                                            æäº¤ç­”æ¡ˆ
                                        </button>
                                    </div>
                                    
                                    <button 
                                        id="returnHome" 
                                        class="w-full bg-white/20 text-white py-3 rounded-xl font-bold text-lg shadow-lg transform transition hover:scale-105 active:scale-95"
                                    >
                                        é€€å‡ºæ¸¸æˆ
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            }

            getTruthOrDareHTML() {
                if (!this.truthOrDareData) return this.getPlayingHTML();
                
                const typeText = this.truthOrDareData.type === 'truth' ? 'çœŸå¿ƒè¯' : 'å¤§å†’é™©';
                const typeColor = this.truthOrDareData.type === 'truth' ? 'from-pink-500 to-purple-600' : 'from-yellow-400 to-orange-500';

                return `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-orange-700 flex flex-col items-center justify-center p-4">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.1),transparent_50%)] opacity-30"></div>
                        <div class="relative max-w-md w-full text-center animate-fadeIn">
                            <h2 class="text-4xl font-black text-white mb-2" style="font-family: Impact, sans-serif; text-shadow: 3px 3px 0px rgba(0,0,0,0.3);">
                                ${this.truthOrDareData.player} çš„${typeText}
                            </h2>
                            <div class="bg-white/10 backdrop-blur rounded-2xl p-8 border-2 border-white/20 my-8">
                                <p class="text-white text-xl font-bold">
                                    ${this.truthOrDareData.challenge}
                                </p>
                            </div>
                            
                            <div class="space-y-4">
                                <button 
                                    id="continuePlaying" 
                                    class="w-full bg-gradient-to-r ${typeColor} text-${this.truthOrDareData.type === 'truth' ? 'white' : 'gray-900'} py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95"
                                >
                                    ç»§ç»­æ¸¸æˆ
                                </button>
                                
                                <button 
                                    id="returnHome" 
                                    class="w-full bg-white/20 text-white py-4 rounded-xl font-bold text-xl shadow-lg transform transition hover:scale-105 active:scale-95"
                                >
                                    è¿”å›ä¸»é¡µ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            getHelpModalHTML() {
                return `
                    <div id="helpOverlay" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                        <div class="bg-gradient-to-br from-purple-900 to-pink-900 rounded-3xl p-8 max-w-lg w-full border-2 border-white/30 shadow-2xl" onclick="event.stopPropagation()">
                            <button id="closeHelpBtn" class="absolute top-4 right-4 text-white hover:text-yellow-300 transition">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                            
                            <h3 class="text-3xl font-black text-white mb-6 text-center" style="font-family: Impact, sans-serif">
                                ğŸ“± å¦‚ä½•å’Œæœ‹å‹ä¸€èµ·ç©ï¼Ÿ
                            </h3>
                            
                            <div class="space-y-4 text-white">
                                <div class="bg-white/10 rounded-xl p-4">
                                    <h4 class="font-bold text-yellow-300 mb-2 flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                        </svg>
                                        ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæˆ¿é—´
                                    </h4>
                                    <p class="text-white/90">ç‚¹å‡»ã€Œåˆ›å»ºæ¸¸æˆã€ï¼Œè¾“å…¥ä½ çš„åå­—ï¼Œé€‰æ‹©äººæ•°ï¼Œç‚¹å‡»ã€Œåˆ›å»ºæˆ¿é—´ã€è·å¾—6ä½æˆ¿é—´å·ã€‚</p>
                                </div>
                                
                                <div class="bg-white/10 rounded-xl p-4">
                                    <h4 class="font-bold text-yellow-300 mb-2 flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        ç¬¬äºŒæ­¥ï¼šåˆ†äº«æˆ¿é—´å·
                                    </h4>
                                    <p class="text-white/90">æŠŠæˆ¿é—´å·å’Œæ¸¸æˆç½‘å€å‘ç»™æœ‹å‹ï¼Œæœ‹å‹æ‰“å¼€ç½‘å€åç‚¹å‡»ã€ŒåŠ å…¥æˆ¿é—´ã€ã€‚</p>
                                </div>
                                
                                <div class="bg-white/10 rounded-xl p-4">
                                    <h4 class="font-bold text-yellow-300 mb-2 flex items-center gap-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                                        </svg>
                                        ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹æ¸¸æˆ
                                    </h4>
                                    <p class="text-white/90">ç­‰æ‰€æœ‰æœ‹å‹åŠ å…¥åï¼Œæˆ¿ä¸»ç‚¹å‡»ã€Œå¼€å§‹æ¸¸æˆã€ï¼Œå°±å¯ä»¥å¼€å§‹çŒœè¯å•¦ï¼</p>
                                </div>
                                
                                <div class="bg-yellow-400/20 rounded-xl p-4 border border-yellow-400/50 mt-6">
                                    <h4 class="font-bold text-yellow-300 mb-2">ğŸ’¡ å°æç¤º</h4>
                                    <ul class="text-white/90 list-disc list-inside space-y-1">
                                        <li>æˆ¿é—´å·ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¾“å…¥æ—¶ä¼šè‡ªåŠ¨è½¬ä¸ºå¤§å†™</li>
                                        <li>æˆ¿é—´ä¼šä¿ç•™1å°æ—¶ï¼Œè¿‡æœŸåéœ€è¦é‡æ–°åˆ›å»º</li>
                                        <li>æ¸¸æˆæ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ï¼Œåˆ·æ–°é¡µé¢ä¸ä¼šä¸¢å¤±</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        const game = new GameState();
        game.render();
    </script>
</body>
</html>
